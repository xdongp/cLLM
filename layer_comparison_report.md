# CPU vs GPU 逐层输出对比测试报告

生成时间: 2026-02-06T13:43:36.537741
模型路径: model/Qwen/Qwen3-0.6B
CPU端口: 18080
GPU端口: 8080

============================================================

## 汇总统计

- 总测试数: 8
- GPU乱码测试数: 0
- 平均CPU质量评分: 0.9368
- 平均GPU质量评分: 0.9045
- 成功率: 100.00%

## 详细测试结果

### 测试用例 1: 'hello'

**CPU 结果:**
- 输出: 'Class = "Hello,'...
- 生成token数: 5
- 响应时间: 0.62ms
- 质量评分: 0.9000
- 乱码检测: ✓
- 长度: 15字符
- 单词数: 3
- 非ASCII比例: 0.0000
- 特殊字符比例: 0.2000

**GPU 结果:**
- 输出: ' great⇃ repbuttonHorizontal'...
- 生成token数: 5
- 响应时间: 0.30ms
- 质量评分: 0.9630
- 乱码检测: ✓
- 长度: 27字符
- 单词数: 2
- 非ASCII比例: 0.0370
- 特殊字符比例: 0.0370

**分析:**
- ✅ GPU输出正常
- 性能对比: GPU比CPU快 2.06x

### 测试用例 2: 'hi'

**CPU 结果:**
- 输出: 'rtle and a dog are'...
- 生成token数: 5
- 响应时间: 0.26ms
- 质量评分: 1.0000
- 乱码检测: ✓
- 长度: 18字符
- 单词数: 5
- 非ASCII比例: 0.0000
- 特殊字符比例: 0.0000

**GPU 结果:**
- 输出: '.setMinimum defStyleopyright悛 level'...
- 生成token数: 5
- 响应时间: 0.24ms
- 质量评分: 0.9714
- 乱码检测: ✓
- 长度: 35字符
- 单词数: 3
- 非ASCII比例: 0.0286
- 特殊字符比例: 0.0286

**分析:**
- ✅ GPU输出正常
- 性能对比: GPU比CPU快 1.08x

### 测试用例 3: '你好'

**CPU 结果:**
- 输出: 'Question，我是一个客户'...
- 生成token数: 5
- 响应时间: 0.25ms
- 质量评分: 0.7333
- 乱码检测: ✓
- 长度: 15字符
- 单词数: 1
- 非ASCII比例: 0.4667
- 特殊字符比例: 0.0667

**GPU 结果:**
- 输出: 'のご实在是BACK-Kusiness'...
- 生成token数: 5
- 响应时间: 0.23ms
- 质量评分: 0.8333
- 乱码检测: ✓
- 长度: 18字符
- 单词数: 1
- 非ASCII比例: 0.2778
- 特殊字符比例: 0.0556

**分析:**
- ✅ GPU输出正常
- 性能对比: GPU比CPU快 1.09x

### 测试用例 4: 'what is'

**CPU 结果:**
- 输出: ' the effect of a high'...
- 生成token数: 5
- 响应时间: 0.29ms
- 质量评分: 1.0000
- 乱码检测: ✓
- 长度: 21字符
- 单词数: 5
- 非ASCII比例: 0.0000
- 特殊字符比例: 0.0000

**GPU 结果:**
- 输出: ' theious price.lt afforded'...
- 生成token数: 5
- 响应时间: 0.43ms
- 质量评分: 0.9808
- 乱码检测: ✓
- 长度: 26字符
- 单词数: 3
- 非ASCII比例: 0.0000
- 特殊字符比例: 0.0385

**分析:**
- ✅ GPU输出正常
- 性能对比: GPU比CPU快 0.67x

### 测试用例 5: '1+1='

**CPU 结果:**
- 输出: '2\n1+1'...
- 生成token数: 5
- 响应时间: 0.37ms
- 质量评分: 0.9000
- 乱码检测: ✓
- 长度: 5字符
- 单词数: 2
- 非ASCII比例: 0.0000
- 特殊字符比例: 0.2000

**GPU 结果:**
- 输出: '2缛ائف Brushes put'...
- 生成token数: 5
- 响应时间: 0.26ms
- 质量评分: 0.8824
- 乱码检测: ✓
- 长度: 17字符
- 单词数: 3
- 非ASCII比例: 0.2353
- 特殊字符比例: 0.0000

**分析:**
- ✅ GPU输出正常
- 性能对比: GPU比CPU快 1.43x

### 测试用例 6: 'The capital of China is'

**CPU 结果:**
- 输出: ' Beijing, and the capital'...
- 生成token数: 5
- 响应时间: 0.42ms
- 质量评分: 0.9800
- 乱码检测: ✓
- 长度: 25字符
- 单词数: 4
- 非ASCII比例: 0.0000
- 特殊字符比例: 0.0400

**GPU 结果:**
- 输出: ' Beijingference.R сто","'...
- 生成token数: 5
- 响应时间: 0.29ms
- 质量评分: 0.8542
- 乱码检测: ✓
- 长度: 24字符
- 单词数: 2
- 非ASCII比例: 0.1250
- 特殊字符比例: 0.1667

**分析:**
- ✅ GPU输出正常
- 性能对比: GPU比CPU快 1.45x

### 测试用例 7: 'Python is a programming language'

**CPU 结果:**
- 输出: ' that has been designed for'...
- 生成token数: 5
- 响应时间: 0.42ms
- 质量评分: 1.0000
- 乱码检测: ✓
- 长度: 27字符
- 单词数: 5
- 非ASCII比例: 0.0000
- 特殊字符比例: 0.0000

**GPU 结果:**
- 输出: ' that Isדלק put сто'...
- 生成token数: 5
- 响应时间: 0.29ms
- 质量评分: 0.8421
- 乱码检测: ✓
- 长度: 19字符
- 单词数: 4
- 非ASCII比例: 0.3158
- 特殊字符比例: 0.0000

**分析:**
- ✅ GPU输出正常
- 性能对比: GPU比CPU快 1.43x

### 测试用例 8: 'Today is a sunny day'

**CPU 结果:**
- 输出: ', and the weather forecast'...
- 生成token数: 5
- 响应时间: 0.42ms
- 质量评分: 0.9808
- 乱码检测: ✓
- 长度: 26字符
- 单词数: 5
- 非ASCII比例: 0.0000
- 特殊字符比例: 0.0385

**GPU 结果:**
- 输出: ', script сто than PASS'...
- 生成token数: 5
- 响应时间: 0.27ms
- 质量评分: 0.9091
- 乱码检测: ✓
- 长度: 22字符
- 单词数: 5
- 非ASCII比例: 0.1364
- 特殊字符比例: 0.0455

**分析:**
- ✅ GPU输出正常
- 性能对比: GPU比CPU快 1.52x

## 根因分析

- 未发现明显问题，GPU输出正常
## 建议的调试步骤

1. **检查权重值**
   - 对比CPU和GPU加载的权重值
   - 验证BF16→FP32转换的精度
   - 检查权重矩阵的维度和形状

2. **逐层调试**
   - 在Embedding层后对比输出
   - 在Attention层后对比输出
   - 在FFN层后对比输出
   - 在最终层后对比输出

3. **检查矩阵乘法**
   - 验证GPU版本的矩阵乘法实现
   - 对比CPU和GPU的矩阵乘法结果
   - 检查GQA的张量维度排列

4. **验证Metal后端**
   - 检查Metal API的使用
   - 验证GPU内存分配和释放
   - 检查数据传输的正确性