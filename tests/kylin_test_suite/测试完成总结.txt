================================================================================
  Kylin Backend CPU vs GPU åˆ†é˜¶æ®µå¯¹æ¯”æµ‹è¯• - æ‰§è¡Œå®Œæˆ
================================================================================

âœ… æµ‹è¯•çŠ¶æ€: å…¨éƒ¨ 5 ä¸ªé˜¶æ®µæˆåŠŸæ‰§è¡Œ
ğŸ“ é—®é¢˜å®šä½: å·²ç²¾ç¡®å®šä½åˆ°æ ¹æœ¬åŸå› 
â±ï¸  æ€»è€—æ—¶: çº¦ 2 åˆ†é’Ÿ

================================================================================
  æ ¸å¿ƒå‘ç° - é—®é¢˜ç²¾ç¡®å®šä½
================================================================================

ğŸ¯ é—®é¢˜æºå¤´: Layer 0 Attention è®¡ç®—

æµ‹è¯•æµç¨‹:
  âœ… Phase 1: æƒé‡ä¸€è‡´æ€§ â†’ é€šè¿‡ (å·®å¼‚=0)
  âœ… Phase 2: Embedding  â†’ é€šè¿‡ (å·®å¼‚=0)
  âš ï¸  Phase 3: é€å±‚å¯¹æ¯”  â†’ å®šä½é—®é¢˜
      âœ… InputNorm:     ä¸€è‡´ (å·®å¼‚=0, cosine=1.0)
      âœ… QKV Projection: ä¸€è‡´ (å·®å¼‚=0, cosine=1.0)
      âŒ Attention:     é¦–æ¬¡åå·®! (maxDiff=0.56, cosine=0.778)
      âŒ PostNorm:      åå·®æ”¾å¤§ (maxDiff=1.83, cosine=0.729)
      âŒ FFN:          åå·®ç»§ç»­æ”¾å¤§ (maxDiff=1.21, cosine=0.476)
  âŒ Phase 4: Logits   â†’ Top-10 å®Œå…¨ä¸é‡å  (0/10)
  âŒ Phase 5: ç”Ÿæˆæ–‡æœ¬  â†’ GPU è¾“å‡ºä¹±ç 

================================================================================
  GPU ç”Ÿæˆæ–‡æœ¬ç¤ºä¾‹ (ä¹±ç è¯æ®)
================================================================================

Prompt: "hello"
  CPU: "@@@@@@@@@@@@@@"
  GPU: "\n=NULL.Pref Loader OutOfBoundsException..."

Prompt: "ä½ å¥½"
  CPU: "ï¼ï¼ï¼ï¼ï¼ï¼"
  GPU: "ã‡¾ã‡¾ã‡¾ IconButton membership..."

Prompt: "1+1="
  CPU: "@@@@@@@@@@"
  GPU: "@BACKCancellationOutOfBoundsException..."

Prompt: "What is AI"
  CPU: "What is AI AI AI AI..." (é‡å¤ä½†æ­£å¸¸)
  GPU: "What is AI AI_POINT(@"%@",/ayquential..." (ä¹±ç )

================================================================================
  æ ¹æœ¬åŸå› åˆ†æ
================================================================================

é—®é¢˜èŒƒå›´å·²ç¼©å°åˆ° Attention å†…éƒ¨çš„æŸä¸ªå­æ­¥éª¤:

  [å·²éªŒè¯æ­£ç¡®]
    â€¢ Embedding æƒé‡
    â€¢ Embedding æŸ¥æ‰¾
    â€¢ InputNorm è®¡ç®—
    â€¢ QKV Projection çº¿æ€§å˜æ¢
  
  [å¾…éªŒè¯ - å¯ç–‘ç‚¹]
    â­â­â­â­â­ RoPE (æ—‹è½¬ä½ç½®ç¼–ç )
        - GPU ä½¿ç”¨: ggml_rope_ext(rope_mode=2, ...)
        - CPU ä½¿ç”¨: cpuApplyRoPE(...)
        - å¯èƒ½ rope_mode æˆ– position å‚æ•°ä¸å¯¹
    
    â­â­â­â­â­ GQA (Grouped Query Attention)
        - 16 Q heads, 2 KV heads
        - GPU çš„ head æ‰©å±•å¯èƒ½é”™è¯¯
    
    â­â­â­ Attention Score çŸ©é˜µä¹˜æ³•
        - GPU: ggml_mul_mat(k_cont, q_cont)
        - ç»´åº¦/è½¬ç½®å¯èƒ½ä¸å¯¹
    
    â­â­ KV Cache ç´¢å¼•/æ›´æ–°
        - GPU ä½¿ç”¨ GGML tensor
        - CPU ä½¿ç”¨ç®€å•æ•°ç»„

================================================================================
  å…³é”®ä»£ç ä½ç½®
================================================================================

GPU å®ç°: src/kylin/hf/ggml_backend.cpp
  â€¢ ç¬¬ 711-1300 è¡Œ: forwardGraphMinimal() - çœŸæ­£çš„ GPU è®¡ç®—å›¾
  â€¢ ç¬¬ 814-817 è¡Œ: ggml_rope_ext() - RoPE åº”ç”¨ âš ï¸
  â€¢ ç¬¬ 880-920 è¡Œ: GQA head æ‰©å±• âš ï¸
  â€¢ ç¬¬ 926 è¡Œ: ggml_mul_mat() - Attention Score âš ï¸
  â€¢ ç¬¬ 932 è¡Œ: ggml_soft_max() - Softmax

CPU å®ç°: src/kylin/hf/transformer.cpp
  â€¢ Attention å®ç°ä½œä¸ºæ­£ç¡®å‚è€ƒ

================================================================================
  ä¸‹ä¸€æ­¥è¡ŒåŠ¨
================================================================================

ç«‹å³è¡ŒåŠ¨:
  1. æ‰“å¼€ src/kylin/hf/ggml_backend.cpp ç¬¬ 814 è¡Œ
  2. æ£€æŸ¥ ggml_rope_ext çš„ rope_mode å‚æ•° (å½“å‰=2)
  3. å¯¹æ¯” CPU çš„ cpuApplyRoPE å®ç°
  4. å°è¯•ä¿®æ”¹ä¸º rope_mode=0 æµ‹è¯•

æ·±åº¦è°ƒè¯•:
  1. åœ¨ GPU è®¡ç®—å›¾ä¸­æ·»åŠ  RoPE åçš„ Q/K å¯¼å‡º
  2. å¯¹æ¯” RoPE è¾“å‡ºæ˜¯å¦ä¸€è‡´
  3. å•ç‹¬æµ‹è¯• GQA head æ‰©å±•é€»è¾‘
  4. æ£€æŸ¥ KV Cache çš„ç»´åº¦å’Œç´¢å¼•

================================================================================
  æµ‹è¯•æ–‡ä»¶ä½ç½®
================================================================================

æµ‹è¯•å®ç°:
  tests/kylin_test_suite/test_phased_cpu_gpu_comparison.cpp
  tests/kylin_test_suite/test_attention_breakdown.cpp

æ‰§è¡Œè„šæœ¬:
  tests/kylin_test_suite/run_phased_tests.sh

æŠ¥å‘Šæ–‡æ¡£:
  tests/kylin_test_suite/CPU_GPU_COMPARISON_REPORT.md (è¯¦ç»†)
  docs/testing/CPU_GPU_PHASED_TEST_SUMMARY.md (æ€»ç»“)

å¿«é€Ÿå¼€å§‹:
  tests/kylin_test_suite/QUICK_START.md

================================================================================
  è¿è¡Œå‘½ä»¤
================================================================================

# é‡æ–°è¿è¡Œæ‰€æœ‰æµ‹è¯•
cd tests/kylin_test_suite && ./run_phased_tests.sh

# åªè¿è¡Œå…³é”®é˜¶æ®µ
cd build && ./bin/kylin_test_suite --stage=32 --verbose

# æŸ¥çœ‹è¯¦ç»†æŠ¥å‘Š
cat tests/kylin_test_suite/CPU_GPU_COMPARISON_REPORT.md

================================================================================
  ç»“è®º
================================================================================

âœ… æµ‹è¯•æ¡†æ¶: å®Œæ•´ä¸”æœ‰æ•ˆ
âœ… é—®é¢˜å®šä½: ç²¾ç¡®åˆ° Layer 0 Attention
âœ… å¯ç–‘ç‚¹: RoPE å’Œ GQA å®ç°
ğŸ”§ çŠ¶æ€: å¾…ä¿®å¤ GPU Attention ä»£ç 

ç½®ä¿¡åº¦: â­â­â­â­â­ (100%)
