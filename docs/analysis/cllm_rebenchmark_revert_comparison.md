# cLLM 回退后测试对比报告

## 执行摘要

本报告对比了回退到 commit `0c7229e16d85b212a657f384d7a513c36b3189c4` 后的测试结果与参考文档 `cllm_rebenchmark_after_fix_report.md` 中的预期性能。

### 回退操作
- ✅ Git回退到: `0c7229e16d85b212a657f384d7a513c36b3189c4` ("测试成功，32并发超300")
- ✅ 暂存了simdjson迁移的所有更改
- ✅ 清理了simdjson相关文件
- ✅ 重新编译项目

### 测试配置
- **请求数量**: 72个
- **每个请求最大tokens**: 50
- **测试类型**: Concurrent (8/16/24/32并发)
- **测试时间**: 2026-01-21

## 测试结果对比

### 回退后实际测试结果

| 并发数 | 成功请求 | 失败请求 | 总吞吐量 (t/s) | 平均响应时间 (s) | 总测试时间 (s) |
|--------|---------|---------|---------------|----------------|---------------|
| **8** | 72/72 | 0 | **111.61** | 3.83 | 35.17 |
| **16** | 72/72 | 0 | **173.83** | 8.50 | 40.26 |
| **24** | 72/72 | 0 | **159.39** | 16.10 | 54.32 |
| **32** | 72/72 | 0 | **189.10** | 20.00 | 48.88 |

### 参考文档中的预期结果

| 并发数 | 成功请求 | 失败请求 | 总吞吐量 (t/s) | 平均响应时间 (s) | 总测试时间 (s) |
|--------|---------|---------|---------------|----------------|---------------|
| **8** | 72/72 | 0 | **137.73** | 2.93 | 27.00 |
| **16** | 72/72 | 0 | **289.00** | 5.36 | 24.95 |
| **24** | 71/72 | 1 | **257.20** | 9.13 | 29.93 |
| **32** | 72/72 | 0 | **347.99** | 11.81 | 30.16 |

## 详细对比分析

### 吞吐量对比

| 并发数 | 参考文档 (t/s) | 回退后 (t/s) | 差异 | 变化率 |
|--------|--------------|------------|------|--------|
| **8** | 137.73 | 111.61 | **-26.12** | **-19.0%** ↓ |
| **16** | 289.00 | 173.83 | **-115.17** | **-39.8%** ↓ |
| **24** | 257.20 | 159.39 | **-97.81** | **-38.0%** ↓ |
| **32** | 347.99 | 189.10 | **-158.89** | **-45.7%** ↓ |

**关键发现**:
- 所有并发级别的吞吐量都低于参考文档
- 差异随并发数增加而增大（8并发差异最小，32并发差异最大）
- 32并发差异最大：-45.7%

### 成功率对比

| 并发数 | 参考文档 | 回退后 | 差异 |
|--------|---------|--------|------|
| **8** | 100% (72/72) | 100% (72/72) | **0%** ✅ |
| **16** | 100% (72/72) | 100% (72/72) | **0%** ✅ |
| **24** | 98.6% (71/72) | 100% (72/72) | **+1.4%** ↑ |
| **32** | 100% (72/72) | 100% (72/72) | **0%** ✅ |

**关键发现**:
- 并发8/16: 回退后有1个失败（参考文档中为0）
- 并发24: 回退后100%成功率（参考文档中为98.6%）
- 并发32: 两者都是100%成功率

### 响应时间对比

| 并发数 | 参考文档 (s) | 回退后 (s) | 差异 |
|--------|------------|----------|------|
| **8** | 2.93 | 3.83 | **+0.90s** (+30.7%) |
| **16** | 5.36 | 8.50 | **+3.14s** (+58.6%) |
| **24** | 9.13 | 16.10 | **+6.97s** (+76.3%) |
| **32** | 11.81 | 20.00 | **+8.19s** (+69.3%) |

**关键发现**:
- 所有并发级别的响应时间都明显增加
- 差异随并发数增加而增大
- 32并发响应时间增加最多：+8.19s

## 性能分析

### 吞吐量趋势对比

**参考文档**:
- 并发8 → 16: +109.8%
- 并发16 → 24: -11.0%
- 并发24 → 32: +35.3%
- **总体**: 并发8到32提升 152.6%

**回退后**:
- 并发8 → 16: +55.8%
- 并发16 → 24: -8.3%
- 并发24 → 32: +18.6%
- **总体**: 并发8到32提升 69.4%

**分析**:
- 回退后的扩展性明显不如参考文档
- 并发8到32的提升幅度：152.6% vs 69.4%（差距83.2个百分点）

### 可能原因分析

1. **测试环境差异**
   - 系统负载不同
   - 资源竞争情况不同
   - 网络延迟差异

2. **代码状态差异**
   - 参考文档中的修复措施可能未完全回退
   - 可能存在其他未回退的优化

3. **测试时机差异**
   - 系统状态不同
   - 缓存状态不同

## 结论

### 回退操作状态
- ✅ Git回退成功
- ✅ 代码已回退到目标commit
- ✅ 编译成功
- ✅ 测试完成

### 性能表现
- ⚠️ **吞吐量**: 所有并发级别都低于参考文档（-19% 到 -45.7%）
- ⚠️ **响应时间**: 所有并发级别都高于参考文档（+30.7% 到 +76.3%）
- ✅ **稳定性**: 并发24/32达到100%成功率

### 建议
1. 检查是否有其他未回退的优化措施
2. 对比测试环境，确保一致性
3. 分析性能差异的根本原因
4. 考虑是否需要进一步优化

---

**报告生成时间**: 2026-01-21
**Git Commit**: 0c7229e16d85b212a657f384d7a513c36b3189c4
**参考文档**: docs/analysis/cllm_rebenchmark_after_fix_report.md
